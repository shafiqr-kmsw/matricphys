<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Pooled-Variance Two-Sample t-test (MathJax)</title>
  <style>
    /* Consolidated and minimized CSS */
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h2 { color: #222; margin-bottom: 6px; }
    textarea { width: 100%; height: 50px; margin-bottom: 6px; font-family: monospace; }
    button { padding: 6px 14px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
    button:hover { background: #0056b3; }
    /* New style for the secondary button */
    #randomDataButton { background: #6c757d; } 
    #randomDataButton:hover { background: #5a6268; }

    table { border-collapse: collapse; margin-top: 10px; width: 100%; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
    th { background: #e9ecef; }
    .result { background: white; border: 1px solid #ccc; padding: 10px; margin-top: 10px; border-radius: 6px; font-size: 14px; }
    .formula { background: #f1f3f5; padding: 6px; border-radius: 6px; margin: 6px 0; font-family: 'Courier New', monospace; font-size: 18px; line-height: 1.3; }
    label { display: block; margin-top: 6px; font-size: 14px; }
    .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 4px; }
    .controls label { margin-top: 0; }
    input[type=number] { width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #bbb; font-size: 14px; }
    select { padding: 4px; border-radius: 4px; border: 1px solid #bbb; font-size: 14px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Pooled-Variance Independent Two-Sample t-test (MathJax)</h2>

  <label>Dataset 1:</label>
  <textarea id="dataset1">12, 15, 14, 10, 13</textarea>

  <label>Dataset 2:</label>
  <textarea id="dataset2">9, 11, 8, 10, 12</textarea>

  <div class="controls">
    <label>Significance level (α):
      <select id="alphaSelect">
        <option value="0.10">0.10</option>
        <option value="0.05" selected>0.05</option>
        <option value="0.01">0.01</option>
        <option value="custom">Custom</option>
      </select>
    </label>
    <label id="customAlphaLabel" style="display:none">Custom $\alpha$: <input id="alphaCustom" type="number" min="0.0001" max="0.5" step="0.0001" value="0.05"></label>

    <label style="margin-left: 4px;"><input id="twoTailed" type="checkbox" checked> Two-tailed</label>

    <button onclick="calculateTTest()">Calculate</button>
    <button id="randomDataButton" onclick="generateRandomData()">Generate Random Data</button>
  </div>

  <div id="output" class="result" aria-live="polite"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.6/jstat.min.js"></script>
  <script>
    const alphaSelect = document.getElementById('alphaSelect');
    const customAlphaLabel = document.getElementById('customAlphaLabel');
    const alphaCustomInput = document.getElementById('alphaCustom');
    const twoTailedCheckbox = document.getElementById('twoTailed');
    const dataset1Input = document.getElementById('dataset1');
    const dataset2Input = document.getElementById('dataset2');
    const outputDiv = document.getElementById('output');

    alphaSelect.addEventListener('change', () => {
      customAlphaLabel.style.display = (alphaSelect.value === 'custom') ? 'inline-block' : 'none';
    });

    // Helper functions
    const fmt = (x) => (typeof x === 'number' && isFinite(x)) ? x.toFixed(3) : 'NaN';
    const mean = (arr) => arr.reduce((a, b) => a + b, 0) / arr.length;
    const sumSquares = (arr, m) => arr.reduce((a, b) => a + Math.pow(b - m, 2), 0);
    const toNumberArray = (text) => text.split(',').map(s => Number(s.trim())).filter(n => !Number.isNaN(n));

    // ⭐ New function to generate and populate random data ⭐
    function generateRandomData() {
      // Helper to get a random integer in a range [min, max]
      const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
      
      // Generate 5 to 10 points for each dataset, values between 5 and 25
      const count1 = randInt(5, 10);
      const count2 = randInt(5, 10);
      
      const data1 = Array.from({ length: count1 }, () => randInt(5, 25)).join(', ');
      const data2 = Array.from({ length: count2 }, () => randInt(5, 25)).join(', ');
      
      dataset1Input.value = data1;
      dataset2Input.value = data2;
      
      // Automatically calculate and display results
      calculateTTest();
    }

    function calculateTTest() {
      const a1 = toNumberArray(dataset1Input.value);
      const a2 = toNumberArray(dataset2Input.value);
      
      if (a1.length < 2 || a2.length < 2) { 
        outputDiv.innerHTML = '<b>Results</b><p>Please provide at least 2 numbers in each dataset.</p>';
        if(window.MathJax && MathJax.typesetPromise) MathJax.typesetClear();
        return; 
      }

      // Calculations
      const n1 = a1.length, n2 = a2.length;
      const m1 = mean(a1), m2 = mean(a2);
      const ss1 = sumSquares(a1, m1), ss2 = sumSquares(a2, m2);

      const df = n1 + n2 - 2;
      const sp2 = (ss1 + ss2) / df;
      const sp = Math.sqrt(sp2);
      const tStat = (m1 - m2) / (sp * Math.sqrt(1 / n1 + 1 / n2));

      let alpha = (alphaSelect.value === 'custom') ? Number(alphaCustomInput.value) : Number(alphaSelect.value);
      if (!(alpha > 0 && alpha < 1)) { 
        outputDiv.innerHTML = '<b>Results</b><p>Enter a valid $\\alpha$ between 0 and 1.</p>';
        if(window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
        return;
      }
      const twoTailed = twoTailedCheckbox.checked;

      let pValue;
      if (twoTailed) { 
        pValue = 2 * (1 - jStat.studentt.cdf(Math.abs(tStat), df)); 
      } else { 
        pValue = (tStat >= 0) ? (1 - jStat.studentt.cdf(tStat, df)) : jStat.studentt.cdf(tStat, df); 
      }

      const q = twoTailed ? (1 - alpha / 2) : (1 - alpha);
      const tCritical = jStat.studentt.inv(q, df);

      // Build Data Table
      let tableRows = '';
      const maxL = Math.max(n1, n2);
      for (let i = 0; i < maxL; i++) {
        const x1 = a1[i] !== undefined ? fmt(a1[i]) : '';
        const x2 = a2[i] !== undefined ? fmt(a2[i]) : '';
        const d1 = a1[i] !== undefined ? fmt(Math.pow(a1[i] - m1, 2)) : '';
        const d2 = a2[i] !== undefined ? fmt(Math.pow(a2[i] - m2, 2)) : '';
        tableRows += `<tr><td>${x1}</td><td>${x2}</td><td>${d1}</td><td>${d2}</td></tr>`;
      }
      
      const table = `<table>
        <tr>
          <th>\\(x_1\\)</th><th>\\(x_2\\)</th>
          <th>\\((x_1-\\bar{x}_1)^2\\)</th><th>\\((x_2-\\bar{x}_2)^2\\)</th>
        </tr>
        ${tableRows}
      </table>`;

      // Build MathJax formulas string
      const lines = [
        `\\( \\bar{x}_1 = ${fmt(m1)}, \\; \\bar{x}_2 = ${fmt(m2)} \\)`,
        `\\( \\sum (x_{1i}-\\bar{x}_1)^2 = ${fmt(ss1)}, \\; \\sum (x_{2i}-\\bar{x}_2)^2 = ${fmt(ss2)} \\)`,
        `\\( s_p^2 = \\tfrac{${fmt(ss1)} + ${fmt(ss2)}}{${n1} + ${n2} - 2} = ${fmt(sp2)} \\)`,
        `\\( s_p = \\sqrt{s_p^2} = ${fmt(sp)} \\)`,
        `\\( t = \\tfrac{\\bar{x}_1 - \\bar{x}_2}{s_p \\sqrt{1/n_1 + 1/n_2}} = \\tfrac{${fmt(m1)} - ${fmt(m2)}}{${fmt(sp)} \\sqrt{1/${n1} + 1/${n2}}} = ${fmt(tStat)} \\)`,
        `\\( df = n_1 + n_2 - 2 = ${n1} + ${n2} - 2 = ${df} \\)`,
        `\\( \\alpha = ${alpha}, \\; ${(twoTailed ? 'two' : 'one')}\\text{-}tailed \\)`,
        `\\( t_{crit} = ${fmt(tCritical)} \\)`,
        `\\( p\\text{-value} = ${fmt(pValue)} \\)`,
      ];
      
      const decision = (pValue < alpha) ? 'Reject\\;H_0' : 'Fail\\;to\\;reject\\;H_0';
      lines.push(`\\( \\text{Decision at } \\alpha = ${alpha}: ${decision} \\)`);

      // Output Results (using template literal for cleaner injection)
      outputDiv.innerHTML = `
        <b>Results (values rounded to 3 decimals)</b>
        ${table}
        <div class="formula">${lines.join('<br>')}</div>
      `;

      // Typeset MathJax
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetClear && MathJax.typesetClear();
        MathJax.typesetPromise();
      }
    }

    // Run on load
    window.addEventListener('load', calculateTTest);
  </script>
</body>
</html>